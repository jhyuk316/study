# 15. 입출력(I/O)

## 1. 자바에서의 입출력

### 1.1 입출력이란?

스트림(Stream)

- 입출력하는데 사용되는 연결 통로
- 데이터 흐름(stream)
- 하나의 스트림으로 입출력을 동시에 수행 할 수 없음.(단방향 통신)
- 입출력을 동시에 수행하기 위해 2개의 스트림 필요.

### 1.2 스트림(stream)

### 1.3 바이트기반 스트림 - InputStream, OutputStream

### 1.4 보조스트림

### 1.5 문자기반 스트림 - Reader, Writer

## 2. 바이트기반 스트림

### 2.1 InputStream과 OutputStream

### 2.2 ByteArrayInputStream과 ByteArrayOutputStream

### 2.3 FileInputStream과 FileOutputStream

## 3. 바이트기반의 보조스트림

### 3.1 FilterInputStream과 FilterOutputStream

### 3.2 BufferedInputStream과 BufferedOutputStream

### 3.3 DataInputStream과 DataOutputStream

### 3.4 SequenceInputStream

### 3.5 PrintStream

## 4. 문자기반 스트림

### 4.1 Reader와 Writer

- Reader - 문자기반 입력스트림의 최고 조상

| Type          | Method                              | Description                                                                             |
| ------------- | ----------------------------------- | --------------------------------------------------------------------------------------- |
| abstract void | close()                             | 입력 스트림을 닫고 자원 반환                                                            |
| void          | mark(int readAheadLimit)            | 현재 위치 표시. 나중에 reset()으로 표시한 위치로 돌아 올 수 있음.                       |
| boolean       | markSupported()                     | mark()와 reset()을 지원하는가?                                                          |
| int           | read()                              | 입력소스로부터 하나의 문자를 읽음. char범위인 0~65535의 정수 반환, 마지막 데이터는 -1   |
| int           | read(char[] cbuf)                   | 배열 cbuf의 크기 많음 읽어서 저장. 읽은 데이터 개수 또는 -1 반환                        |
| abstract int  | read(char[] cbuf, int off, int len) | 최대 len개의 문자를 읽어서 cbuf배열의 off위치 부터 저장. 읽은 데이터 개수 또는 -1 반환. |
| boolean       | ready()                             | 입력 소스로부터 데이터를 읽을 준비가 되었는지 확인                                      |
| void          | reset()                             | 입력소스에서의 위치를 마지막으로 mark()가 호출되었던 위치로 돌림.                       |
| long          | skip(long n)                        | 현재 위치에서 주어진 n만큼 건너 뜀.                                                     |

- Writer

| Type          | Method                               | Description                                                               |
| ------------- | ------------------------------------ | ------------------------------------------------------------------------- |
| abstract void | close()                              | 출력 스트림을 닫고, 자원 반환                                             |
| abstract void | flush()                              | 스트림 버퍼에 있는 모든 내용을 출력 소스에 씀.(버퍼가 있는 스트림만 해당) |
| void          | write(int c)                         | 주어진 값을 출력 소스에 쓰기                                              |
| void          | write(char[] cbuf)                   | 주어진 배열을 출력 소스에 쓰기                                            |
| abstract void | write(char[] cbuf, int off, int len) | 주어진 배열c의 off번째부터 len개 만큼 쓰기                                |
| void          | write(String str)                    | 주어진 문자열을 쓰기                                                      |
| void          | write(String str, int off, int len)  | 주어진 문자열의 off번째 부터 len개 만큼 쓰기                              |

### 4.2 FileReader와 FileWriter

- 문자기반의 파일 입출력
- 텍스트 파일의 입출력에 사용.

```java
class FileReaderEx1 {
    public static void main(String args[]) {
        try {
            String fileName = "test.txt";
            FileInputStream fis = new FileInputStream(fileName);
            FileReader      fr  = new FileReader(fileName);

            int data =0;

            // FileInputStream을 이용해서 파일내용을 읽어 화면에 출력한다.
            while((data=fis.read())!=-1) {
                System.out.print((char)data);
            }
            System.out.println();
            fis.close();

            // FileReader를 이용해서 파일내용을 읽어 화면에 출력한다.
            while((data=fr.read())!=-1) {
                System.out.print((char)data);
            }
            System.out.println();
            fr.close();

        } catch (IOException e) {
                e.printStackTrace();
        }
    } // main
}
```

### 4.3 PipedReader와 PipedWriter

- 쓰레드 간의 통신에 사용

```java
public class PipedReaderWriter {
    public static void main(String args[]) {
        InputThread inThread = new InputThread("InputThread");
        OutputThread outThread = new OutputThread("OutputThread");

        // PipedReader¿Í PipedWriter¸¦ ¿¬°áÇÑ´Ù.
        inThread.connect(outThread.getOutput());

        inThread.start();
        outThread.start();
    } // main
}


class InputThread extends Thread {
    PipedReader input = new PipedReader();
    StringWriter sw = new StringWriter();

    InputThread(String name) {
        super(name); // Thread(String name);
    }

    public void run() {
        try {
            int data = 0;

            while ((data = input.read()) != -1) {
                sw.write(data);
            }
            System.out.println(getName() + " received : " + sw.toString());
        } catch (IOException e) {
        }
    } // run

    public PipedReader getInput() {
        return input;
    }

    public void connect(PipedWriter output) {
        try {
            input.connect(output);
        } catch (IOException e) {
        }
    } // connect
}


class OutputThread extends Thread {
    PipedWriter output = new PipedWriter();

    OutputThread(String name) {
        super(name); // Thread(String name);
    }

    public void run() {
        try {
            String msg = "Hello";
            System.out.println(getName() + " sent : " + msg);
            output.write(msg);
            output.close();
        } catch (IOException e) {
        }
    } // run

    public PipedWriter getOutput() {
        return output;
    }

    public void connect(PipedReader input) {
        try {
            output.connect(input);
        } catch (IOException e) {
        }
    } // connect
}

```

소스 참조 - <https://github.com/castello/javajungsuk3/blob/master/source/ch15/PipedReaderWriter.java>

### 4.4 StringReader와 StringWriter

- CharArrayReader, CharArrayWriter처럼 메모리 입출력에 사용
- StringWriter에 출력되는 데이터는 내부의 StringBuffer에 저장

```java
class StringReaderWriterEx {
    public static void main(String[] args) {
        String inputData = "ABCD";
        StringReader input  = new StringReader(inputData);
        StringWriter output = new StringWriter();

        int data = 0;

        try {
            while((data = input.read())!=-1) {
                output.write(data); // void write(int b)
            }
        } catch(IOException e) {}

        System.out.println("Input Data  :" + inputData);
        System.out.println("Output Data :" + output.toString());
        // System.out.println("Output Data :" + output.getBuffer().toString());
    }
}
```

소스 참조 - <https://github.com/castello/javajungsuk3/blob/master/source/ch15/StringReaderWriterEx.java>

## 5. 문자기반의 보조스트림

### 5.1 BufferedReader와 BufferedWriter

- 입출력 효율을 높이기 위해 버퍼(char[])를 사용하는 보조 스트림.
- 라인(line)단위의 입출력이 편리.

```java
class BufferedReaderEx1 {
    public static void main(String[] args) {
        try {
            FileReader fr = new FileReader("BufferedReaderEx1.java");
            BufferedReader br = new BufferedReader(fr);

            String line = "";
            for(int i=1;(line = br.readLine())!=null;i++) {
                //  ";"를 포함한 라인을 출력한다.
                if(line.indexOf(";")!=-1)
                    System.out.println(i+":"+line);
            }

            br.close();
        } catch(IOException e) {}
    } // main
}
```

소스 참조 - <https://github.com/castello/javajungsuk3/blob/master/source/ch15/BufferedReaderEx1.java>

### 5.2 InputStreamReader와 OutputStreamWriter

- 바이트기반스트림을 문자기반스트림처럼 쓸 수 있음.
- 인코딩(encoding)을 변환하여 입출력할 수 있음.

| 생성자/메서드                                         | 설명                                                               |
| ----------------------------------------------------- | ------------------------------------------------------------------ |
| InputStreamReader(InputStream in)                     | os에서 사용하는 기본 인코딩 문자로 변환하는 InputStreamReader생성  |
| InputStreamReader(InputStream in, String encoding)    | 지정된 인코딩 문자로 변환하는 InputStreamReader생성                |
| String getEncoding()                                  | InputStreamReader의 인코딩 반환                                    |
| OutputStreamReader(OutputStream out)                  | os에서 사용하는 기본 인코딩 문자로 변환하는 OutputStreamReader생성 |
| OutputStreamReader(OutputStream out, String encoding) | 지정된 인코딩 문자로 변환하는 OutputStreamReader생성               |
| String getEncoding()                                  | OutputStreamReader의 인코딩 반환                                   |

- 콘솔에서 라인 단위로 입력받기

  ```java
  InputStreamReader isr = new InputStreamReader(System.in);
  BufferedRedader br = new BufferedReader(isr);
  String line = br.readLine();
  ```

- 인코딩 변환하기

  ```java
  FileInputStream fis = new FileInputStream("korean.txt");
  InputStreamReader isr = new InputStreamReader(fis, "KSC5601");
  ```

## 6. 표준입출력과 File

### 6.1 표준입출력 - System.in, System.out, System.err

- 표준입출력 - 콘솔을 통한 데이터의 입출력
- JVM이 시작 되면서 자동적으로 생성되는 스트림

> System.in - 콘솔로부터 데이터를 입력받는데 사용  
> System.out - 콘솔로 데이터를 출력하는데 사용  
> System.err - 콘솔로 데이터를 출력하는데 사용

### 6.2 표준입출력의 대상변경 - setOut(), setErr(), setIn()

```java
static void setOut(PrintStream out);
static void setErr(PrintStream err);
static void setIn(PrintStream in);
```

### 6.3 RandomAccessFile

- 하나의 스트림으로 파일에 입력과 출력을 모두 수행할 수 있는 스트림.
- 다른 스트림과 달리 Object의 자손

```java
// DataInput 인터페이스의 메서드
boolean readBoolean();
byte readByte();
int readInt();
void readFullly(byte[] b);
String readLine();
```

```java
void write(byte[] b)
void write(int b)
void writeBoolean(boolean b)
void writeInt(int v)
void writeBytes(String s)
```

| 생성자/메서드                                  | 설명                                                                                           |
| ---------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| RandomAccessFile(File file, String mode)       | 주어진 file에 읽기 또는 쓰기를 하기위한 RandomAccessFile인스턴스 생성. 모드는 "r", "rw"가 가능 |
| RandomAccessFile(String fileName, String mode) |                                                                                                |
| long getFilePointer()                          | 파일 포인터의 위치를 반환                                                                      |
| long length()                                  | 파일으 크기를 반환(byte 단위)                                                                  |
| void seek(long pos)                            | 파일 포인터의 위치 변경. 첫 부분에서 pos만큼 떨어진 곳.(byte 단위)                             |
| void setLength(long newLength)                 | 파일 크기를 지정된 길이로 변경(byte 단위)                                                      |
| int skipBytes(int n)                           | 지정된 수만큼 byte를 건너뜀                                                                    |

### 6.4 File

- 파일과 디렉토리를 다루는데 사용되는 클래스

| Modifier and Type   | Constructors / Field              | Description                                                                                     |
| ------------------- | --------------------------------- | ----------------------------------------------------------------------------------------------- |
|                     | File(File parent, String child)   | Creates a new File instance from a parent abstract pathname and a child pathname string.        |
|                     | File(String pathname)             | Creates a new File instance by converting the given pathname string into an abstract pathname.  |
|                     | File(String parent, String child) | Creates a new File instance from a parent pathname string and a child pathname string.          |
|                     | File(URI uri)                     | Creates a new File instance by converting the given file: URI into an abstract pathname.        |
| static final String | pathSeparator                     | The system-dependent path-separator character, represented as a string for convenience.         |
| static final char   | pathSeparatorChar                 | The system-dependent path-separator character.                                                  |
| static final String | separator                         | The system-dependent default name-separator character, represented as a string for convenience. |
| static final char   | separatorChar                     | The system-dependent default name-separator character.                                          |

| Modifier and Type | Method                                                       | Description                                                                                                                                                     |
| ----------------- | ------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| boolean           | canExecute()                                                 | Tests whether the application can execute the file denoted by this abstract pathname.                                                                           |
| boolean           | canRead()                                                    | Tests whether the application can read the file denoted by this abstract pathname.                                                                              |
| boolean           | canWrite()                                                   | Tests whether the application can modify the file denoted by this abstract pathname.                                                                            |
| int               | compareTo(File pathname)                                     | Compares two abstract pathnames lexicographically.                                                                                                              |
| boolean           | createNewFile()                                              | Atomically creates a new, empty file named by this abstract pathname if and only if a file with this name does not yet exist.                                   |
| static File       | createTempFile(String prefix, String suffix)                 | Creates an empty file in the default temporary-file directory, using the given prefix and suffix to generate its name.                                          |
| static File       | createTempFile(String prefix, String suffix, File directory) | Creates a new empty file in the specified directory, using the given prefix and suffix strings to generate its name.                                            |
| boolean           | delete()                                                     | Deletes the file or directory denoted by this abstract pathname.                                                                                                |
| void              | deleteOnExit()                                               | Requests that the file or directory denoted by this abstract pathname be deleted when the virtual machine terminates.                                           |
| boolean           | equals(Object obj)                                           | Tests this abstract pathname for equality with the given object.                                                                                                |
| boolean           | exists()                                                     | Tests whether the file or directory denoted by this abstract pathname exists.                                                                                   |
| File              | getAbsoluteFile()                                            | Returns the absolute form of this abstract pathname.                                                                                                            |
| String            | getAbsolutePath()                                            | Returns the absolute pathname string of this abstract pathname.                                                                                                 |
| File              | getCanonicalFile()                                           | Returns the canonical form of this abstract pathname.                                                                                                           |
| String            | getCanonicalPath()                                           | Returns the canonical pathname string of this abstract pathname.                                                                                                |
| long              | getFreeSpace()                                               | Returns the number of unallocated bytes in the partition named by this abstract path name.                                                                      |
| String            | getName()                                                    | Returns the name of the file or directory denoted by this abstract pathname.                                                                                    |
| String            | getParent()                                                  | Returns the pathname string of this abstract pathname's parent, or null if this pathname does not name a parent directory.                                      |
| File              | getParentFile()                                              | Returns the abstract pathname of this abstract pathname's parent, or null if this pathname does not name a parent directory.                                    |
| String            | getPath()                                                    | Converts this abstract pathname into a pathname string.                                                                                                         |
| long              | getTotalSpace()                                              | Returns the size of the partition named by this abstract pathname.                                                                                              |
| long              | getUsableSpace()                                             | Returns the number of bytes available to this virtual machine on the partition named by this abstract pathname.                                                 |
| int               | hashCode()                                                   | Computes a hash code for this abstract pathname.                                                                                                                |
| boolean           | isAbsolute()                                                 | Tests whether this abstract pathname is absolute.                                                                                                               |
| boolean           | isDirectory()                                                | Tests whether the file denoted by this abstract pathname is a directory.                                                                                        |
| boolean           | isFile()                                                     | Tests whether the file denoted by this abstract pathname is a normal file.                                                                                      |
| boolean           | isHidden()                                                   | Tests whether the file named by this abstract pathname is a hidden file.                                                                                        |
| long              | lastModified()                                               | Returns the time that the file denoted by this abstract pathname was last modified.                                                                             |
| long              | length()                                                     | Returns the length of the file denoted by this abstract pathname.                                                                                               |
| String[]          | list()                                                       | Returns an array of strings naming the files and directories in the directory denoted by this abstract pathname.                                                |
| String[]          | list(FilenameFilter filter)                                  | Returns an array of strings naming the files and directories in the directory denoted by this abstract pathname that satisfy the specified filter.              |
| File[]            | listFiles()                                                  | Returns an array of abstract pathnames denoting the files in the directory denoted by this abstract pathname.                                                   |
| File[]            | listFiles(FileFilter filter)                                 | Returns an array of abstract pathnames denoting the files and directories in the directory denoted by this abstract pathname that satisfy the specified filter. |
| File[]            | listFiles(FilenameFilter filter)                             | Returns an array of abstract pathnames denoting the files and directories in the directory denoted by this abstract pathname that satisfy the specified filter. |
| static File[]     | listRoots()                                                  | List the available filesystem roots.                                                                                                                            |
| boolean           | mkdir()                                                      | Creates the directory named by this abstract pathname.                                                                                                          |
| boolean           | mkdirs()                                                     | Creates the directory named by this abstract pathname, including any necessary but nonexistent parent directories.                                              |
| boolean           | renameTo(File dest)                                          | Renames the file denoted by this abstract pathname.                                                                                                             |
| boolean           | setExecutable(boolean executable)                            | A convenience method to set the owner's execute permission for this abstract pathname.                                                                          |
| boolean           | setExecutable(boolean executable, boolean ownerOnly)         | Sets the owner's or everybody's execute permission for this abstract pathname.                                                                                  |
| boolean           | setLastModified(long time)                                   | Sets the last-modified time of the file or directory named by this abstract pathname.                                                                           |
| boolean           | setReadable(boolean readable)                                | A convenience method to set the owner's read permission for this abstract pathname.                                                                             |
| boolean           | setReadable(boolean readable, boolean ownerOnly)             | Sets the owner's or everybody's read permission for this abstract pathname.                                                                                     |
| boolean           | setReadOnly()                                                | Marks the file or directory named by this abstract pathname so that only read operations are allowed.                                                           |
| boolean           | setWritable(boolean writable)                                | A convenience method to set the owner's write permission for this abstract pathname.                                                                            |
| boolean           | setWritable(boolean writable, boolean ownerOnly)             | Sets the owner's or everybody's write permission for this abstract pathname.                                                                                    |
| Path              | toPath()                                                     | Returns a java.nio.file.Path object constructed from this abstract path.                                                                                        |
| String            | toString()                                                   | Returns the pathname string of this abstract pathname.                                                                                                          |
| URI               | toURI()                                                      | Constructs a file: URI that represents this abstract pathname.                                                                                                  |

### 7. 직렬화(Serialization)

### 7.1 직렬화란?

### 7.2 ObjectInputStream과 ObjectOutputStream

### 7.3 직렬화가 가능한 클래스 만들기 - Serializable, transient

### 7.4 직렬화가능한 클래스의 버전관리
